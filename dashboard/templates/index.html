<!DOCTYPE html>
<html>
<head>
    <title>Vehicle Dashboard</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #fff; text-align: center; }
        .dashboard { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; }
        .card { background: #333; padding: 20px; border-radius: 10px; width: 300px; }
        h2 { margin-top: 0; }
        .value { font-size: 2em; font-weight: bold; color: #0f0; }
        .label { color: #aaa; }
        canvas { background: #000; border-radius: 50%; }
    </style>
</head>
<body>
    <h1>Vehicle Telemetry</h1>
    <div class="dashboard">
        <div class="card">
            <h2>Speed</h2>
            <canvas id="speedGauge" width="200" height="200"></canvas>
            <div class="value"><span id="speedVal">0.0</span> m/s</div>
            <div class="label">Target: <span id="targetSpeedVal">0.0</span></div>
        </div>

        <div class="card">
            <h2>Kinematics</h2>
            <div style="text-align: left; padding-left: 20px;">
                <div>VX: <span id="vxVal" class="value" style="font-size: 1.2em">0.0</span> m/s</div>
                <div>VY: <span id="vyVal" class="value" style="font-size: 1.2em">0.0</span> m/s</div>
                <div>Ω: <span id="omegaVal" class="value" style="font-size: 1.2em">0.0</span> rad/s</div>
            </div>
        </div>
        
        <div class="card">
            <h2>Acceleration</h2>
             <div class="value"><span id="accelVal">0.0</span> m/s²</div>
             <div class="label">Decel: <span id="decelVal">0.0</span> m/s²</div>
        </div>

        <div class="card">
            <h2>Steering</h2>
            <canvas id="steerGauge" width="200" height="200"></canvas>
            <div class="value"><span id="steerVal">0.0</span>°</div>
        </div>
    </div>
    
    <div class="card" style="width: 80%; margin: 20px auto;">
        <h2>Motor Status</h2>
        <pre id="motorStatus" style="text-align: left; font-size: 0.8em; overflow: auto; max-height: 200px;"></pre>
    </div>

    <script>
        const ws = new WebSocket("ws://" + window.location.host + "/ws");
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            updateDashboard(data);
        };

        function updateDashboard(data) {
            document.getElementById('speedVal').innerText = (data.speed || 0).toFixed(1);
            document.getElementById('targetSpeedVal').innerText = (data.target_speed || 0).toFixed(1);
            document.getElementById('vxVal').innerText = (data.vx || 0).toFixed(2);
            document.getElementById('vyVal').innerText = (data.vy || 0).toFixed(2);
            document.getElementById('omegaVal').innerText = (data.omega || 0).toFixed(2);
            document.getElementById('accelVal').innerText = (data.accel || 0).toFixed(1);
            document.getElementById('decelVal').innerText = (data.decel || 0).toFixed(1);
            document.getElementById('steerVal').innerText = (data.steer_angle || 0).toFixed(1);
            document.getElementById('motorStatus').innerText = JSON.stringify(data.motors, null, 2);

            drawSpeedGauge(data.speed || 0);
            drawSteerGauge(data.steer_angle || 0);
        }

        function drawSpeedGauge(speed) {
            const canvas = document.getElementById('speedGauge');
            const ctx = canvas.getContext('2d');
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            const radius = 80;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Background Arc
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0.75 * Math.PI, 2.25 * Math.PI);
            ctx.lineWidth = 10;
            ctx.strokeStyle = '#444';
            ctx.stroke();
            
            // Value Arc (Max speed 10 m/s)
            const maxSpeed = 10;
            const ratio = Math.min(Math.abs(speed) / maxSpeed, 1);
            const endAngle = 0.75 * Math.PI + (1.5 * Math.PI * ratio);
            
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0.75 * Math.PI, endAngle);
            ctx.lineWidth = 10;
            ctx.strokeStyle = speed >= 0 ? '#0f0' : '#f00';
            ctx.stroke();
        }

        function drawSteerGauge(angle) {
            const canvas = document.getElementById('steerGauge');
            const ctx = canvas.getContext('2d');
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            const radius = 80;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Wheel
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, 2 * Math.PI);
            ctx.lineWidth = 5;
            ctx.strokeStyle = '#666';
            ctx.stroke();
            
            // Angle Indicator
            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(angle * Math.PI / 180);
            
            ctx.fillStyle = '#0af';
            ctx.fillRect(-10, -radius + 10, 20, radius * 2 - 20);
            
            ctx.restore();
        }
    </script>
</body>
</html>
